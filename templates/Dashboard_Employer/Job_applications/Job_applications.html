<!DOCTYPE html>
<html lang="en">

<head>
    {%load static%}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="{%static 'css/Dashboard_Employer/Job_applications/style.css'%}">
    <script src="jquery-3.6.4.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <title>Khedmati</title>
</head>


<body>
    {%block content%}
    <div class="nav_bar">{%include 'Dashboard_Employer/nav_bar/nav_bar.html'%}</div>

    <div class="main">
        <div class="top_bar">{%include 'Dashboard_Employer/nav_bar/top_bar.html'%}</div>
        <div class="nav-title">
            <h2> Job Applications</h2>
            <div class="nav-title-link"><a href="{%url 'home'%}">Home</a><span> Job Applications </span></div>
        </div>
        <div class="nav-main">
            <div class="nav-main-title">
                <ion-icon name="document"></ion-icon>
                <h3>Job Applications</h3>
            </div>
            <hr>
            <div class="search-box">
                <label for="">Search :</label>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <form method="get" action="{% url 'job_applications' %}">
                        <input type="text" id="search-input" name="q" value="{{ query }}">
                    </form>
                </div>
            </div>

            {% for message in messages %}
            <p class="messages">{{ message }}</p> 
            {% endfor %}
            <script>
                setTimeout(function() {
                    document.querySelector('.messages').remove();
                }, 5000); 
                </script>

        <div class="jobs-table">
            <table>
                <thead>
                    <tr>
                        <td>Job Title</td>
                        <td>Date Applied</td>
                        <td>Candidate Name</td>
                        <td>Candidate Email</td>
                        <td>Phone Number</td>
                        <td>Address</td>
                        <td>Resume</td>
                        <td>Status</td>
                        <td>Actions</td>
                    </tr>
                </thead>
                <tbody>
                    {% for Application in applications %}
                    <tr>
                        <td>{{ Application.idJob.job_title }}</td>
                        <td>{{ Application.date_applied }}</td>
                        <td>{{ Application.idCandidate.first_name }} {{ Application.idCandidate.last_name }}</td>
                        <td>{{ Application.idCandidate.email }}</td>
                        <td>{{ Application.idCandidate.phone }}</td>
                        <td>{{ Application.idCandidate.address }}</td>
                        <td>
                            <a href="{{ Application.idCandidate.resume }}" >Download Resume</a>
                        </td>
                        <td class="job-response-cell">
                            <form method="post">
                                {% csrf_token %}
                                <input type="hidden" name="application_id" value="{{ Application.idApplication }}">
                                <select name="status" class="job-response" onchange="this.form.submit()">
                                    <option value="pending" {% if Application.status == 'pending' %}selected{% endif %}>Pending</option>
                                    <option value="accepted" {% if Application.status == 'accepted' %}selected{% endif %}>Accepted</option>
                                    <option value="rejected" {% if Application.status == 'rejected' %}selected{% endif %}>Rejected</option>
                                </select>
                            </form>

                        </td>                    
                        <td>
                            <a href="{% url 'delete_application' Application.idApplication %}" style="text-decoration:none;">
                                <span class="delete-icon"></span>
                            </a>
                        </td>                    
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9">No job applications found.</td>
                    </tr>
                    {% endfor %}

                </tbody>
            </table>
        </div>

        </div>

        <div class="margin-bottom"></div>
    </div>

    {%endblock%}
</body>

<script src="{%static 'js/Dashboard_Employer/Job_applications/custom.js'%}"></script>

</html>